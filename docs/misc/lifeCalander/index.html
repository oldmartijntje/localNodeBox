<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life in Weeks</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .week-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border: 1px solid #ccc;
            display: inline-block;
            margin: 1px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .week-dot.selected {
            transform: scale(1.5);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            z-index: 1;
            position: relative;
        }

        .week-dot.has-note {
            border: 2px solid #FFD700;
        }

        .childhood {
            background-color: #FF9999;
            border-color: #FF6666;
        }

        .teenage {
            background-color: #99FF99;
            border-color: #66FF66;
        }

        .adult {
            background-color: #9999FF;
            border-color: #6666FF;
        }

        #weeks-container {
            max-width: 900px;
            margin: 20px auto;
            text-align: center;
        }

        .stats {
            margin: 20px 0;
            font-size: 1.2em;
        }

        .legend {
            margin: 20px 0;
            text-align: center;
        }

        .legend-item {
            display: inline-block;
            margin: 0 10px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            vertical-align: middle;
        }

        .error-message {
            color: #dc3545;
            margin-top: 10px;
            display: none;
        }

        .selected-info {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            display: none;
        }

        .note-area {
            margin-top: 10px;
        }

        .future-date {
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Life in Weeks</h1>

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Select your birthdate</h5>
                        <input type="date" id="birthdate" class="form-control">
                        <div id="error-message" class="error-message">Invalid date selected</div>
                        <div class="stats" id="stats"></div>
                        <div class="selected-info" id="selected-info">
                            <div id="week-info"></div>
                            <div class="note-area">
                                <textarea id="week-note" class="form-control" rows="3"
                                    placeholder="Add a note for this week..."></textarea>
                                <button id="save-note" class="btn btn-primary mt-2">Save Note</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot" style="background-color: #FF9999; border: 1px solid #FF6666;"></div>
                <span>Childhood (0-12)</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background-color: #99FF99; border: 1px solid #66FF66;"></div>
                <span>Teenage (12-18)</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background-color: #9999FF; border: 1px solid #6666FF;"></div>
                <span>Adult (18+)</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="border: 2px solid #FFD700;"></div>
                <span>Has Note</span>
            </div>
        </div>

        <div id="weeks-container"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const birthdateInput = document.getElementById('birthdate');
            const weeksContainer = document.getElementById('weeks-container');
            const statsDiv = document.getElementById('stats');
            const errorMessage = document.getElementById('error-message');
            const selectedInfo = document.getElementById('selected-info');
            const weekInfo = document.getElementById('week-info');
            const weekNote = document.getElementById('week-note');
            const saveNoteBtn = document.getElementById('save-note');
            let selectedDot = null;
            let currentWeekIndex = null;
            let notes = JSON.parse(localStorage.getItem('weekNotes') || '{}');

            const savedDate = localStorage.getItem('birthdate');
            const defaultDate = new Date();
            defaultDate.setFullYear(defaultDate.getFullYear() - 18);

            if (savedDate) {
                birthdateInput.value = savedDate;
            } else {
                birthdateInput.valueAsDate = defaultDate;
            }

            function isValidDate(date) {
                const today = new Date();
                const minDate = new Date();
                minDate.setFullYear(today.getFullYear() - 150);
                return date <= today && date >= minDate;
            }

            function formatDate(date) {
                return date.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            function getDateForWeek(birthdate, weekIndex) {
                const date = new Date(birthdate);
                date.setDate(date.getDate() + (weekIndex * 7));
                return date;
            }

            function getNoteKey(birthdate, weekIndex) {
                return `${birthdate.toISOString()}_week${weekIndex}`;
            }

            function saveNote() {
                if (currentWeekIndex !== null) {
                    const noteKey = getNoteKey(new Date(birthdateInput.value), currentWeekIndex);
                    const noteText = weekNote.value.trim();

                    if (noteText) {
                        notes[noteKey] = noteText;
                        selectedDot.classList.add('has-note');
                    } else {
                        delete notes[noteKey];
                        selectedDot.classList.remove('has-note');
                    }

                    localStorage.setItem('weekNotes', JSON.stringify(notes));
                }
            }

            function selectDot(dot, weekIndex) {
                if (selectedDot) {
                    selectedDot.classList.remove('selected');
                }

                dot.classList.add('selected');
                selectedDot = dot;
                currentWeekIndex = weekIndex;

                const birthdate = new Date(birthdateInput.value);
                const weekDate = getDateForWeek(birthdate, weekIndex);
                const today = new Date();
                const daysOld = weekIndex * 7;
                const yearsOld = (daysOld / 365.25).toFixed(2);

                const noteKey = getNoteKey(birthdate, weekIndex);
                weekNote.value = notes[noteKey] || '';

                selectedInfo.style.display = 'block';

                let dateInfo;
                if (weekDate > today) {
                    dateInfo = `<div class="future-date">This will be on ${formatDate(weekDate)}</div>`;
                } else {
                    dateInfo = `Date: ${formatDate(weekDate)}`;
                }

                weekInfo.innerHTML = `
                    <strong>Selected Week ${weekIndex + 1}</strong><br>
                    Age: ${yearsOld} years (${daysOld} days)<br>
                    ${dateInfo}
                `;
            }

            function generateDots() {
                const birthdate = new Date(birthdateInput.value);
                const today = new Date();

                if (!isValidDate(birthdate)) {
                    errorMessage.style.display = 'block';
                    errorMessage.textContent = birthdate > today ?
                        "Birthdate cannot be in the future" :
                        "Birthdate cannot be more than 150 years ago";
                    return;
                }

                errorMessage.style.display = 'none';
                selectedInfo.style.display = 'none';
                weeksContainer.innerHTML = '';
                selectedDot = null;
                currentWeekIndex = null;

                const weeksLived = Math.floor((today - birthdate) / (7 * 24 * 60 * 60 * 1000));
                const childhoodWeeks = 12 * 52;
                const teenageWeeks = 18 * 52;

                const totalWeeks = Math.max(5200, Math.ceil(weeksLived / 52) * 52 + 52);
                const maxWeeks = 150 * 52;
                const weeksToShow = Math.min(totalWeeks, maxWeeks);

                for (let i = 0; i < weeksToShow; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'week-dot';

                    const noteKey = getNoteKey(birthdate, i);
                    if (notes[noteKey]) {
                        dot.classList.add('has-note');
                    }

                    if (i < weeksLived) {
                        if (i < childhoodWeeks) {
                            dot.classList.add('childhood');
                        } else if (i < teenageWeeks) {
                            dot.classList.add('teenage');
                        } else {
                            dot.classList.add('adult');
                        }
                    }

                    dot.addEventListener('click', () => selectDot(dot, i));
                    weeksContainer.appendChild(dot);
                }

                const yearsLived = (weeksLived / 52).toFixed(1);
                const totalYears = (weeksToShow / 52).toFixed(0);
                statsDiv.innerHTML = `
                    You've lived approximately ${weeksLived} weeks (${yearsLived} years)<br>
                    That's ${((weeksLived / weeksToShow) * 100).toFixed(1)}% of ${totalYears} years
                `;

                localStorage.setItem('birthdate', birthdateInput.value);
            }

            generateDots();

            birthdateInput.addEventListener('change', generateDots);
            saveNoteBtn.addEventListener('click', saveNote);
            weekNote.addEventListener('keydown', function (e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    saveNote();
                }
            });
        });
    </script>
</body>

</html>